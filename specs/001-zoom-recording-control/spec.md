# 功能規格：LINE Bot 遠端 Zoom 會議與螢幕錄製控制

**功能分支**: `001-zoom-recording-control`
**建立日期**: 2025-11-14
**狀態**: 草稿
**輸入**: 使用者描述：「透過 LINE Bot 提供選單，讓使用者遠端操作 Mac 電腦自動加入 Zoom 會議、控制螢幕錄製」

## 使用者情境與測試 *(必填)*

### 使用者故事 1 - 加入 Zoom 會議（優先級：P1）

使用者透過 LINE Bot 輸入會議資訊（會議 ID、密碼、顯示名稱），系統自動在遠端 Mac 電腦上加入 Zoom 會議，並確保會議視窗全螢幕顯示在最前方。

**優先級理由**: 這是核心功能，是所有後續操作的基礎。沒有成功加入會議，錄製和其他功能都無法執行。

**獨立測試**: 可透過在 LINE 輸入會議資訊，驗證 Mac 是否成功加入 Zoom 會議並全螢幕顯示，即可完整測試此功能並交付價值。

**驗收情境**:

1. **Given** 使用者已開啟 LINE Bot 對話，**When** 使用者點擊「加入會議」選單並輸入會議 ID（純數字）、密碼和顯示名稱，**Then** 系統在 Mac 上啟動 Zoom 並加入指定會議，會議視窗全螢幕顯示在最前方
2. **Given** 使用者已開啟 LINE Bot 對話，**When** 使用者輸入會議 ID 時，**Then** 行動裝置自動彈出數字鍵盤
3. **Given** 系統正在嘗試加入會議，**When** 會議 ID 或密碼錯誤導致加入失敗，**Then** 使用者收到明確的錯誤通知訊息
4. **Given** 使用者已成功加入過至少一場會議，**When** 使用者點擊「快速加入最近會議」，**Then** 系統自動使用最近一次的會議資訊加入會議

---

### 使用者故事 2 - 控制螢幕錄製（優先級：P2）

使用者透過 LINE Bot 控制遠端 Mac 開始和停止螢幕錄製，錄製包含系統音訊。錄製操作需要使用者確認，停止後提供錄製檔案資訊和連結。

**優先級理由**: 錄製功能是主要需求之一，但必須先能加入會議才有意義，因此排在 P2。

**獨立測試**: 可透過在 LINE 點擊錄製按鈕，驗證 Mac 是否開始/停止錄製螢幕和音訊，並在停止後收到檔案資訊，即可完整測試此功能。

**驗收情境**:

1. **Given** 使用者已開啟 LINE Bot 對話，**When** 使用者點擊「開始錄製」按鈕，**Then** 系統顯示確認對話框要求使用者確認
2. **Given** 系統顯示錄製確認對話框，**When** 使用者在 60 秒內確認執行，**Then** Mac 開始錄製螢幕和系統音訊，LINE Bot 按鈕切換為「停止錄製」
3. **Given** 系統正在錄製中，**When** 使用者點擊「停止錄製」並確認，**Then** Mac 停止錄製，使用者收到包含檔名、時長和影片連結的訊息
4. **Given** 系統顯示確認對話框，**When** 使用者拒絕或 60 秒內未回應，**Then** 操作取消，系統狀態維持不變
5. **Given** 系統正在錄製螢幕，**When** 錄製進行中，**Then** 錄製內容包含系統音訊（透過 BlackHole Multi-Output 或類似工具）

---

### 使用者故事 3 - 查看即時狀態（優先級：P3）

使用者透過 LINE Bot 查看遠端 Mac 的當前狀態，包含螢幕截圖、會議狀態和錄製狀態。

**優先級理由**: 狀態查詢提升使用體驗和信心，但不是核心操作流程的必要條件。

**獨立測試**: 可透過在 LINE 點擊「查看狀態」，驗證是否收到螢幕截圖和狀態資訊，即可完整測試此功能。

**驗收情境**:

1. **Given** 使用者已開啟 LINE Bot 對話，**When** 使用者點擊「查看狀態」，**Then** 系統回傳當前 Mac 螢幕截圖、會議狀態（未加入/進行中/會議 ID）、錄製狀態（未錄製/錄製中/錄製時長）
2. **Given** 使用者查詢狀態，**When** 系統回傳狀態資訊，**Then** 所有狀態資訊包含時間戳記

---

### 使用者故事 4 - 離開 Zoom 會議（優先級：P4）

使用者透過 LINE Bot 控制遠端 Mac 離開 Zoom 會議，操作需要使用者確認以避免誤觸。

**優先級理由**: 離開會議是輔助功能，使用者也可以不透過 Bot 直接在 Zoom 中離開，因此優先級較低。

**獨立測試**: 可透過在 LINE 點擊「離開會議」並確認，驗證 Mac 是否成功退出 Zoom 會議，即可完整測試此功能。

**驗收情境**:

1. **Given** Mac 正在 Zoom 會議中，**When** 使用者點擊「離開會議」，**Then** 系統顯示確認對話框要求使用者確認
2. **Given** 系統顯示離開會議確認對話框，**When** 使用者在 60 秒內確認執行，**Then** Mac 離開 Zoom 會議，使用者收到操作完成通知
3. **Given** 系統顯示確認對話框，**When** 使用者拒絕或 60 秒內未回應，**Then** 操作取消，維持在會議中

---

### 邊界情況

- 當使用者在未加入會議的狀態下點擊「開始錄製」時會發生什麼？
- 當網路連線中斷導致 LINE Bot 與 Mac 失去連線時如何處理？
- 當 Mac 電腦處於睡眠或鎖定狀態時如何處理指令？
- 當 Zoom 應用程式未安裝或版本過舊時如何處理？
- 當多個使用者同時嘗試控制同一台 Mac 時如何處理？
- 當錄製儲存空間不足時如何處理？
- 當系統音訊裝置（如 BlackHole）未正確設定時如何處理？
- 當使用者在錄製過程中突然關閉 LINE 或斷線時如何處理？

## 需求 *(必填)*

### 功能需求

**會議管理需求**:

- **FR-001**: 系統必須提供 LINE Bot 選單介面，讓使用者點擊功能選項
- **FR-002**: 系統必須支援使用者輸入會議 ID（純數字格式）、會議密碼和顯示名稱
- **FR-003**: 系統必須在使用者輸入會議 ID 時，自動觸發行動裝置的數字鍵盤
- **FR-004**: 系統必須能遠端控制 Mac 電腦加入指定的 Zoom 會議
- **FR-005**: 系統必須確保加入會議後，Zoom 視窗自動切換為全螢幕模式並保持在最前方
- **FR-006**: 系統必須儲存最近使用的會議資訊（至少最近 5 筆）
- **FR-007**: 系統必須提供「快速加入最近會議」功能，自動填入最近一次的會議資訊
- **FR-008**: 系統必須在加入會議失敗時，向使用者發送明確的錯誤通知（如會議 ID 錯誤、密碼錯誤、網路問題等）

**錄製控制需求**:

- **FR-009**: 系統必須使用第三方螢幕錄製工具（非 Zoom 內建錄製功能）
- **FR-010**: 系統必須在開始錄製前顯示確認對話框，要求使用者明確確認
- **FR-011**: 系統必須在停止錄製前顯示確認對話框，要求使用者明確確認
- **FR-012**: 確認對話框必須在 60 秒後自動逾時，操作自動取消
- **FR-013**: 系統必須錄製系統音訊（包含 Zoom 會議聲音）
- **FR-014**: 系統必須將開始錄製和停止錄製合併為同一個按鈕（切換式按鈕）
- **FR-015**: 錄製按鈕初始狀態必須顯示「開始錄製」，點擊確認後切換為「停止錄製」
- **FR-016**: 系統必須在停止錄製後，提供錄製檔案的基本資訊（檔名、錄製時長）
- **FR-017**: 系統必須在停止錄製後，提供可存取錄製影片的連結

**狀態查詢需求**:

- **FR-018**: 系統必須支援使用者查詢當前 Mac 電腦狀態
- **FR-019**: 狀態資訊必須包含當前螢幕截圖
- **FR-020**: 狀態資訊必須包含會議狀態（未加入會議 / 會議進行中及會議 ID）
- **FR-021**: 狀態資訊必須包含錄製狀態（未錄製 / 錄製中及已錄製時長）
- **FR-022**: 所有狀態資訊必須包含時間戳記

**會議離開需求**:

- **FR-023**: 系統必須提供離開 Zoom 會議的功能
- **FR-024**: 系統必須在離開會議前顯示確認對話框，要求使用者明確確認
- **FR-025**: 確認對話框必須在 60 秒後自動逾時，操作自動取消

**安全性需求**:

- **FR-026**: 系統必須驗證 LINE Bot webhook 請求的簽章，確保請求來源合法
- **FR-027**: 系統必須維護授權使用者白名單，僅允許特定 LINE 使用者 ID 執行操作
- **FR-028**: 系統必須記錄所有使用者操作的審計日誌（包含時間戳記、使用者 ID、操作類型）
- **FR-029**: 所有敏感資訊（LINE Bot token、Zoom API 憑證等）必須透過環境變數或加密設定檔儲存
- **FR-030**: 系統必須在啟動時驗證必要憑證是否存在且有效

**錯誤處理需求**:

- **FR-031**: 系統必須捕獲所有異常並避免服務崩潰
- **FR-032**: 系統必須向使用者提供易懂的錯誤訊息（避免技術術語）
- **FR-033**: 系統必須記錄詳細錯誤資訊供除錯使用（包含堆疊追蹤、系統狀態）
- **FR-034**: 系統必須在暫時性失敗時實作重試機制（指數退避）
- **FR-035**: 系統必須確保錯誤發生時不會讓系統處於不一致狀態

### 關鍵實體

- **會議記錄 (Meeting Record)**: 代表一次 Zoom 會議的資訊，包含會議 ID、密碼、顯示名稱、使用時間戳記
- **錄製工作 (Recording Session)**: 代表一次螢幕錄製，包含開始時間、結束時間、檔案路徑、檔案大小、時長、狀態（錄製中/已完成）
- **系統狀態 (System Status)**: 代表 Mac 電腦當前狀態，包含會議狀態、錄製狀態、最後更新時間
- **使用者操作記錄 (User Action Log)**: 代表使用者執行的操作審計記錄，包含使用者 ID、操作類型、時間戳記、執行結果

## 成功標準 *(必填)*

### 可衡量成果

- **SC-001**: 使用者能在 30 秒內完成會議加入流程（從點擊選單到 Mac 成功進入全螢幕會議）
- **SC-002**: 會議加入成功率達到 95% 以上（排除使用者輸入錯誤的情況）
- **SC-003**: 使用者在點擊錄製按鈕後 5 秒內開始實際錄製
- **SC-004**: 系統能正確錄製系統音訊，音訊品質清晰可辨識
- **SC-005**: 使用者在操作失敗時能在 10 秒內收到明確的錯誤通知
- **SC-006**: 狀態查詢回應時間在 5 秒以內（包含螢幕截圖生成和傳輸）
- **SC-007**: 90% 以上的使用者能在首次使用時成功完成主要任務（加入會議和錄製）
- **SC-008**: 確認對話框能有效防止誤觸，誤操作率低於 5%
- **SC-009**: 系統能連續穩定運行 24 小時以上，不因異常而崩潰
- **SC-010**: 所有安全相關操作（webhook 驗證、使用者授權）的失敗嘗試都被完整記錄

## 假設與限制

### 假設

- 使用者擁有有效的 LINE 帳號，且已加入 LINE Bot 為好友
- Mac 電腦已安裝 Zoom 客戶端應用程式
- Mac 電腦已安裝並正確設定螢幕錄製工具和音訊路由工具（如 BlackHole Multi-Output）
- Mac 電腦具備穩定的網路連線
- Mac 電腦已授予必要的系統權限（螢幕錄製、輔助使用、自動化控制）
- 使用者擁有足夠的儲存空間供錄製檔案使用
- 使用者操作 LINE Bot 的裝置為智慧型手機或平板
- 系統採用分散式架構，雲端服務具備固定 IP 以接收 LINE Bot webhook
- 雲端服務與本地 Mac 透過安全的 VPN 技術建立加密連線

### 限制

- 此功能僅支援 macOS 平台，不支援 Windows 或 Linux
- 系統不支援多個使用者同時控制同一台 Mac（單一控制者模式）
- 錄製檔案儲存位置固定，由系統設定決定
- 系統不提供錄製檔案的編輯或後製功能
- 會議記錄僅保留最近 5 筆，超過後自動刪除最舊的記錄
- 確認對話框逾時時間固定為 60 秒，無法由使用者自訂
- 本地 Mac 需穩定的網路連線，斷線期間將無法接收遠端控制指令
- 系統依賴第三方 VPN 服務的可用性和穩定性

## 相依性

- LINE Messaging API：用於接收使用者訊息和發送回應
- Zoom 客戶端應用程式：必須安裝在 Mac 上
- 第三方螢幕錄製工具：如 QuickTime、ffmpeg 或其他 macOS 相容工具
- 音訊路由工具：如 BlackHole Multi-Output，用於捕捉系統音訊
- macOS 輔助使用 API：用於自動化控制 Zoom 視窗和按鈕
- 檔案儲存與分享服務：用於提供錄製影片連結（如 Google Drive、Dropbox 或本地網路儲存）
- VPN 服務：用於建立雲端與本地 Mac 之間的安全加密隧道（如 Tailscale、ngrok 等）
- 雲端運算平台：提供固定 IP 的 Gateway 服務部署環境（如 AWS、GCP、Azure 等）

## 範圍外項目

以下項目明確不包含在此功能範圍內：

- Zoom 會議的錄製（必須使用第三方工具而非 Zoom 內建功能）
- 錄製檔案的自動上傳到雲端儲存（需手動設定或另外實作）
- 多台 Mac 電腦的管理（僅支援單一 Mac）
- 會議排程和行事曆整合
- 會議參與者管理（靜音、移除參與者等）
- 螢幕分享控制
- 會議聊天訊息的監控或發送
- 錄製影片的自動轉檔或壓縮
- 即時直播功能
- 支援 Zoom 以外的視訊會議平台（如 Google Meet、Microsoft Teams）
